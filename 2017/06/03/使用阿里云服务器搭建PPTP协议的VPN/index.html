<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="SEU Linux Club"><title>使用阿里云服务器搭建PPTP协议的VPN · 东南大学Linux俱乐部</title><meta name="description" content="作为运维，我手上现在有一个位于美国硅谷的阿里云ECS服务器。秉承物尽其用的原则，正好搭建一个VPN服务器。
环境介绍
CPU：1核心Haswell架构的处理器
内存：1GB+自己配置的4GB的Swapfile(相当于虚拟内存)
操作系统：Ubuntu14.04LTS 64位

准备工作Linux平台"><meta name="keywords" content="Linux &amp; More"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">Club Blog</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">SEU LINUX Blog</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li class="soc"><a href="https://github.com/SEULinuxClub" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a><a href="http://SEULinuxClub.github.io/atom.xml" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2018&nbsp;<a target="_blank" href="http://SEULinuxClub.github.io" rel="noopener noreferrer">SEU Linux Club</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>使用阿里云服务器搭建PPTP协议的VPN</a></p><p class="post-meta"><span class="date meta-item">发布于&nbsp;2017-06-03</span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a href="/tags/VPN/" title="VPN" class="a-tag">VPN</a><span>&nbsp;</span></span></p><p class="post-abstract"><p>作为运维，我手上现在有一个位于美国硅谷的阿里云ECS服务器。秉承物尽其用的原则，正好搭建一个VPN服务器。</p>
<h1 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h1><ul>
<li>CPU：1核心Haswell架构的处理器</li>
<li>内存：1GB+自己配置的4GB的Swapfile(相当于虚拟内存)</li>
<li>操作系统：Ubuntu14.04LTS 64位</li>
</ul>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="Linux平台准备"><a href="#Linux平台准备" class="headerlink" title="Linux平台准备"></a>Linux平台准备</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//安装openssh-client</span><br><span class="line">sudo apt install openssh-client</span><br><span class="line">//连接服务器</span><br><span class="line">//例如</span><br><span class="line">ssh root@127.0.0.1 //ssh 用户名@服务器的公网IP</span><br></pre></td></tr></table></figure>
<h2 id="Windows平台准备"><a href="#Windows平台准备" class="headerlink" title="Windows平台准备"></a>Windows平台准备</h2><ol>
<li>安装PuTTY或者XShell，想要更傻瓜操作一点可以安装WinSCP供后续使用</li>
<li>使用PuTTY或者XShell连接服务器</li>
</ol>
<h2 id="安卓平台准备"><a href="#安卓平台准备" class="headerlink" title="安卓平台准备"></a>安卓平台准备</h2><p>我就是用我的小米4C上软工课无聊配置得VPN哈哈哈哈，所以我也写一下好了</p>
<ol>
<li>安装connectBot(详见<a href="https://github.com/connectbot/connectbot" target="_blank" rel="noopener">GitHub</a>)</li>
<li>使用connectBot连接服务器</li>
</ol>
<h1 id="安装有关软件"><a href="#安装有关软件" class="headerlink" title="安装有关软件"></a>安装有关软件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//服务器上</span><br><span class="line">sudo apt install ppp iptables pptpd</span><br></pre></td></tr></table></figure>
<p>炒鸡简单是吧</p>
<h1 id="更改相关配置"><a href="#更改相关配置" class="headerlink" title="更改相关配置"></a>更改相关配置</h1><h2 id="更改使用的工具"><a href="#更改使用的工具" class="headerlink" title="更改使用的工具"></a>更改使用的工具</h2><h3 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /file //或者vim</span><br><span class="line">//用上下键移动光标到需要修改的那一行，按“i”键进入插入编辑状态，修改完成之后，按“esc”键退出编辑，直接在键盘上输入“:wq"即可保存退出。</span><br><span class="line"></span><br><span class="line">//好在不一定要用vi/vim，用nano也OK</span><br><span class="line">nano /file</span><br><span class="line">//上下左右都能移动光标，除了不能用鼠标以外没什么难度。修改完成按Ctrl+X，问是否保存按Y，之后保存名称不用改直接回车。找不到就按Ctrl+W查找就是。</span><br></pre></td></tr></table></figure>
<p>nano的具体操作可以看<a href="http://codingstandards.iteye.com/blog/802593" target="_blank" rel="noopener">我使用过的Linux命令之nano - 比vi简单易用的文本编辑器</a></p>
<h3 id="图形化"><a href="#图形化" class="headerlink" title="图形化"></a>图形化</h3><p>使用WinSCP以root用户登录，使用WinSCP提供的文本编辑功能双击修改即可。修改完成之后Ctrl+S保存，问你是否覆盖，选是即可。</p>
<h2 id="修改配置文件-以使用nano为例"><a href="#修改配置文件-以使用nano为例" class="headerlink" title="修改配置文件(以使用nano为例)"></a>修改配置文件(以使用nano为例)</h2><h3 id="编辑pptpd-conf"><a href="#编辑pptpd-conf" class="headerlink" title="编辑pptpd.conf"></a>编辑pptpd.conf</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/pptpd.conf</span><br><span class="line">//找到#localip 192.168.0.1</span><br><span class="line">//   #remoteip 192.168.0.234-238,192.168.0.245</span><br><span class="line">//删去#号即可</span><br></pre></td></tr></table></figure>
<h3 id="编辑options"><a href="#编辑options" class="headerlink" title="编辑options"></a>编辑options</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/ppp/options</span><br><span class="line"></span><br><span class="line">//搜索ms-dns，去掉搜索到的两行ms-dns前面的#，并修改为下面的字段</span><br><span class="line">//ms-dns 8.8.8.8</span><br><span class="line">//ms-dns 8.8.4.4</span><br></pre></td></tr></table></figure>
<h3 id="编辑chap-secrets"><a href="#编辑chap-secrets" class="headerlink" title="编辑chap-secrets"></a>编辑chap-secrets</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/ppp/chap-secrets</span><br><span class="line">//添加一行，按照下面格式输入：</span><br><span class="line">//用户名 pptpd 密码 *</span><br><span class="line">//比如 zizhuo pptpd zizhuo *</span><br><span class="line">//*的含义是不限制连接者的IP地址，想要限制的话改成那个IP即可</span><br></pre></td></tr></table></figure>
<h3 id="编辑sysctl-conf-内核文件"><a href="#编辑sysctl-conf-内核文件" class="headerlink" title="编辑sysctl.conf(内核文件)"></a>编辑sysctl.conf(内核文件)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">//将net.ipv4.ip_forward=0</span><br><span class="line">//改成net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>
<h2 id="添加iptables转发规则"><a href="#添加iptables转发规则" class="headerlink" title="添加iptables转发规则"></a>添加iptables转发规则</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth1 -j MASQUERADE</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>--table    -t table    table to manipulate (default: `filter’)</li>
<li>--append  -A chain        Append to chain</li>
<li>--source    -s address[/mask][…] source specification</li>
<li>--out-interface -o output name[+] &emsp;network interface name &emsp;eth1是阿里云服务器的连接外网的网卡，可以用ifconfig看一下哪一块网卡是外网IP就可以</li>
<li>–jump    -j target &emsp;&emsp;target for rule (may load target extension)</li>
</ul>
<h2 id="启动pptpd"><a href="#启动pptpd" class="headerlink" title="启动pptpd"></a>启动pptpd</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service pptpd restart</span><br><span class="line">//或者</span><br><span class="line">/etc/init.d/pptpd restart</span><br></pre></td></tr></table></figure>
<h2 id="设置开机自启"><a href="#设置开机自启" class="headerlink" title="设置开机自启"></a>设置开机自启</h2><p>貌似现在默认就可以，不过我还是说一下吧<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//Ubutnu没有chkconfig，可以用rcconf</span><br><span class="line">sudo apt install rcconf</span><br><span class="line">rcconf on</span><br><span class="line">//之后会看到菜单，按空格选择开启/关闭，Tab键跳出选择OK/Cancel</span><br></pre></td></tr></table></figure></p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>去看看所谓的“真实世界”吧2333，下篇文章再见。</p>
</p></div><div class="share"><span>分享到</span>&nbsp;<span class="soc"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></span><span class="soc"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></span><span class="soc"><a href="http://twitter.com/home?status=http://SEULinuxClub.github.io/2017/06/03/使用阿里云服务器搭建PPTP协议的VPN/%20东南大学Linux俱乐部%20使用阿里云服务器搭建PPTP协议的VPN" class="fa fa-twitter"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/2017/06/03/归一化谷歌距离的计算方法/" title="归一化谷歌距离的计算方法"><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: 归一化谷歌距离的计算方法</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/2017/06/03/计算机输入输出系统接口实验报告/" title="计算机输入输出系统接口实验报告">下一篇: 计算机输入输出系统接口实验报告&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zNjY3Ny8xMzIxMg=="><script type="text/javascript">(function (d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') {
        return;
    }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script><noscript> Please activate JavaScript for write a comment in LiveRe</noscript></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2018&nbsp;<a target="_blank" href="http://SEULinuxClub.github.io" rel="noopener noreferrer">SEU Linux Club</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>